/*
 Jquery - Alpha Image
 Version 1.0.0 (03.03.2013)

 Author : Ilker Guller (http://ilkerguller.com)

 Description: This plugin can change selected colours to transparent and give result as image or imagedata. This plugin works IE9+, Chrome, Firefox, Safari.
 Details: https://github.com/Sly777/Jquery-Alpha-Image
 */
(function(b){var a={colour:"",onlyData:false,canvasId:"cnvsAlphaImage",onComplete:function(){}};b.alphaimage=function(f,n){var d=this;d.$el=b(f);d.el=f;var l=new Image(),i;l.crossOrigin="Anonymous";var j=function(){d.imageWidth=d.el.naturalWidth;d.imageHeight=d.el.naturalHeight;d.imageURL=d.$el.attr("src");if(d.imageWidth===""||d.imageHeight===""||d.imageURL===""){console.log("Problem! Plugin cannot get image info...");return false}return true};var m=function(){if(d.options.colour===""){console.log("Problem! Colour value is null...");return false}var o;if(d.options.colour.indexOf("#")===-1){o=h(d.options.colour)}else{o=e(d.options.colour)}if(o===null){console.log("Problem! Colour value is null...");return false}else{d.imageColour=o}return true};var e=function(q){var p=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;q=q.replace(p,function(t,v,u,s){return v+v+u+u+s+s});var o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(q);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:null};var h=function(p){var o=p.split(",");return(o.length===3)?{r:parseInt(o[0]),g:parseInt(o[1]),b:parseInt(o[2])}:null};var c=function(){d.$canvas=b('<canvas id="'+d.options.canvasId+'" width="'+d.imageWidth+'" height="'+d.imageHeight+'" style="visibility: hidden;"></canvas>');d.$canvas.appendTo("body");d.ctx=d.$canvas[0].getContext("2d")};var k=function(q,s,o,r){var t=q.data;for(var p=0;p<t.length;p+=4){if(t[p]===s&&t[p+1]===o&&t[p+2]===r){t[p+3]=1}}q.data=t;return q};var g=function(){var p=d.$canvas[0].toDataURL("image/png");var o=new Image();o.src=p;return{imageSrc:p,image:o}};l.onerror=function(){console.log("Problem! Plugin didn't download image...");return false};l.onload=function(){d.ctx.drawImage(l,0,0);i=d.ctx.getImageData(0,0,d.imageWidth,d.imageHeight);d.ctx.putImageData(k(i,d.imageColour.r,d.imageColour.g,d.imageColour.b),0,0);var o=g();d.$canvas.remove();if(d.options.onlyData){if(typeof d.options.onComplete!=="function"){console.log("Problem! Plugin cannot find onComplete Event...");return false}d.options.onComplete(o)}else{d.$el.attr("src",o.imageSrc)}};d.init=function(){d.options=b.extend({},b.alphaimage.defaultOptions,n);j();m();c();l.src=d.imageURL};d.init()};b.alphaimage.defaultOptions=a;b.fn.alphaimage=function(c){return this.each(function(){(new b.alphaimage(this,c))})}})(jQuery);